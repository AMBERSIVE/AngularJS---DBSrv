!function(a,b,c){"use strict";angular.module("ambersive.db",[]),angular.module("ambersive.db").factory("authenticationInjector",["$injector","$q","$log","$dbSettings","$timeout",function(a,b,d,e,f){var g={request:function(a){var f=b.defer(),g=e.storageName,h=e.storageLang,i=e.tokenName,j=e.tokenType,k=null,l=null,m=e.langName,n=function(a){f.resolve(a)};return(g===c||""===g||0===g.length)&&d.warn("ambersive.db: LocalStorage name is not set"),"undefined"!=typeof Storage?(k=localStorage.getItem(g),l=localStorage.getItem(h)):d.warn("ambersive.db: this browser doesn't support localStorage"),a.headers[i]=j+" "+k,null!==l&&(a.headers["Accept-Language"]=l,a.headers[m]=l),n(a),f.promise},response:function(a){var b=a.headers(),f=e.storageName,g=function(a){if(b[a]!==c&&""!==b[a]){if("undefined"!=typeof Storage)return localStorage.setItem(f,b[a]),b[a];d.warn("ambersive.db: this browser doesn't support localStorage")}},h=g(f);return(h===c||""===h)&&(h=g(f.toLocaleLowerCase())),a}};return g}]),angular.module("ambersive.db").config(["$httpProvider","$dbSettingsProvider",function(a,b){var c=null,d=b.$get().storageLang,e=b.$get().langName;a.interceptors.push("authenticationInjector"),"undefined"!=typeof Storage&&(c=localStorage.getItem(d),null!==c&&(a.defaults.headers.common["Accept-Language"]=c,a.defaults.headers.common[e]=c))}]),angular.module("ambersive.db").provider("$dbSettings",[function(){var a="",b="application/json; charset=utf-8;",d="accessToken",e="language",f="Bearer",g="Authorization",h="Language",i="AMBERSIVE.DB",j={},k=function(a,b){return j[a]=b,j},l=function(a){return j[a]},m=function(b){return a=b},n=function(a){return b=a},o=function(a,b){if(a!==c&&b!==c){switch(a){case"tokenType":f=b;break;default:g=b}return b}},p=function(a){return d=a},q=function(a){return e=a},r=function(a){return i=a};return{register:k,setBaseUrl:m,setContentType:n,setTokenAttribute:o,setStorageName:p,setStorageLang:q,setDatabaseName:r,$get:function(){return{baseUrl:a,contentType:b,routes:j,route:l,storageName:d,storageLang:e,tokenName:g,tokenType:f,langName:h,databaseName:i}}}}]),angular.module("ambersive.db").factory("DB",["$q","$log","$http","$dbSettings",function(a,b,d,e){var f="",g=null,h={},i=function(a,b){var d={method:a.toUpperCase()},f=e.baseUrl,g="/",h="";switch(b!==c&&b.baseUrl!==c&&b.baseUrl.length>0&&(f=b.baseUrl),b!==c&&b.url!==c&&(h=b.url),f!==c&&f.endsWith(g)?g="":f+=g,a){default:d.url=f+g+h}return d.headers={},d.headers["Content-Type"]=e.contentType,b!==c&&b.contentType!==c&&(d.headers["Content-Type"]=b.contentType),d},j=function(b){return{$has:function(b){var d=a.defer();return h[f]===c||h[f][b]===c?d.resolve(!1):d.resolve(!0),d.promise},get:function(c){var e=a.defer();return g=i("get",b),angular.isDefined(c)&&(g.params=c),d(g).success(function(a,b,c,d){e.resolve(a,c)}).error(function(a,b,c,d){e.reject(a,c)}),e.promise},getById:function(c,e){var f=a.defer();return g=i("get",b),g.url+="/"+c,angular.isDefined(e)&&(g.params=e),d(g).success(function(a,b,c,d){f.resolve(a,c)}).error(function(a,b,c,d){f.reject(a,c)}),f.promise},update:function(c,e,f){var g=a.defer(),h=i("put",b);return h.url+="/"+c,h.data=e,angular.isDefined(f)&&(h.params=f),d(h).success(function(a,b,c,d){g.resolve(a)}).error(function(a,b,c,d){g.reject(a)}),g.promise},create:function(c,e){var f=a.defer(),g=i("post",b);return g.data=c,angular.isDefined(e)&&(g.params=e),d(g).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(a)}),f.promise},"delete":function(c,e){var f=a.defer(),g=i("delete",b);return g.url+="/"+c,angular.isDefined(e)&&(g.params=e),d(g).success(function(a,b,c,d){f.resolve(a)}).error(function(a,b,c,d){f.reject(a)}),f.promise}}},k=function(){var d,g,i=null,k=null,l=[];if(arguments.length>0){var m=!1;angular.isObject(arguments[0])&&arguments[0].name!==c&&(k=arguments[0].name,arguments[1]!==c&&(m=arguments[1])),angular.isString(arguments[0])&&(k=arguments[0]),"$"===k?i={classes:function(){var b=a.defer(),c=Object.keys(h),d=[];return angular.forEach(c,function(a,e){d.push({key:a}),e+1===c.length&&b.resolve(d)}),b.promise},methods:function(b){var c=a.defer(),d=null,e=[],f=[];return angular.isDefined(h[b])?(d=h[b],e=Object.keys(d),angular.forEach(e,function(a,b){"$"!==a.substr(0,1)&&f.push({key:a}),b+1===e.length&&c.resolve(f)})):c.reject(f),c.promise}}:(h[k]===c&&m===!1?(g=e.route(k),(g===c||angular.isObject(arguments[0]))&&(g=arguments[0]),h[k]=new j(g),l=[],d=e.route(k),d===c&&angular.isObject(arguments[0])&&(d=g),d!==c&&d.except!==c&&(l=d.except),l.length>0&&l.forEach(function(a,b){h[k][a]!==c&&delete h[k][a]})):m===!0&&(g=e.route(k),(g===c||angular.isObject(arguments[0]))&&(g=arguments[0]),l=[],d=e.route(k),d===c&&angular.isObject(arguments[0])&&(d=g),h[k]===c&&(h[k]=new j(d),d!==c&&d.except!==c&&(l=d.except),l.length>0&&l.forEach(function(a,b){h[k][a]!==c&&delete h[k][a]}))),angular.isObject(arguments[0])&&arguments[0].name!==c&&arguments[0].fnName!==c&&(h[k][arguments[0].fnName]=arguments[0].fn),f=k,i=h[k])}else b.warn("Please define a Service");return i};return k}]),angular.module("ambersive.db").factory("REST",["$q","$log","$http","$dbSettings",function(a,b,c,d){var e=function(b){var d=a.defer();return c(b).success(function(a,b,c,e){d.resolve(a,c)}).error(function(a,b,c,e){d.reject(a,c)}),d.promise};return e}])}(window,document,void 0);