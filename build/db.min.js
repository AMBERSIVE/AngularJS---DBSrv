!function(a,b,c){var d=[],e=[],f=[],g={toId:function(a){var b=[],c=[],d=null;if(angular.isDefined(a)!==!1&&null!==a){if(b.push(a.method),b.push(a.url),angular.isDefined(a.params)){for(d in a.params)c.push(d+"="+a.params[d]);b.push("?"+c.join("&"))}if(angular.isDefined(a.data)&&angular.isObject(a.data))try{b.push(JSON.stringify(a.data))}catch(e){}return b.join("::")}},getUnique:function(a,b){return b===c&&(b=""),a===c&&(a=16),b+Math.random().toString(a).slice(2)},finished:function(){return 0===d.length?!0:!1}};angular.module("ambersive.db",[]),angular.module("ambersive.db").factory("DBRegister",[function(){return g}]),angular.module("ambersive.db").factory("DBHelper",["$http","$q","$rootScope","$dbSettings",function(a,b,c,d){var e={},f=[],h=[];return e.isOnline=function(){return angular.isDefined(navigator)===!0&&angular.isDefined(navigator.onLine)===!0?navigator.onLine:!0},e.execute=function(i,j){var k=g.toId(i),l=h.indexOf(k),m=b.defer(),n=function(g){var m=b.defer(),n=null;return e.isOnline()===!1&&angular.isDefined(j)===!0&&(angular.isDefined(j.fn)===!0&&angular.isFunction(j.fn)===!0&&j.fn(m,l,f),angular.isDefined(j.stop)&&j.stop===!0)?m.promise:(angular.isDefined(g)&&null!==g&&(g.timeout=m.promise),n=a(g).success(function(a,b,c,d){null!==a&&m.resolve(a,d.isLastCall)}).error(function(a,b,e,f){var g=!1;if(g=angular.isDefined(i.catchAllErrorResult)&&angular.isBoolean(i.catchAllErrorResult)?i.catchAllErrorResult:d.catchAllErrorResult,200!==b)switch(b){case 401:d.catch401Result===!0?(g=!0,c.$broadcast("DBHelperCatched401",{data:a,config:f,headers:e,defer:m})):c.$broadcast("DBHelperCatchedError",{status:b,data:a,config:f,headers:e,defer:m});break;default:c.$broadcast("DBHelperCatchedError",{status:b,data:a,config:f,headers:e,defer:m})}null!==a&&g===!1&&m.reject(a,f.isLast)}),n.abort=function(){m.resolve(null,n)},l>-1?(f[l].abort(),f[l]=n,h[l]=k):(f.push(n),h.push(k)),m.promise)};return n(i).then(function(a){null!==a&&m.resolve(a)},function(a){null!==a&&m.reject(a)}),m.promise},e}]),angular.module("ambersive.db").factory("authenticationInjector",["$injector","$q","$log","$dbSettings","$timeout",function(a,b,d,e,f){var g={request:function(a){var f=b.defer(),g=e.storageName,h=e.storageLang,i=e.tokenName,j=e.tokenType,k=null,l=null,m=e.langName,n=function(a){f.resolve(a)};return(g===c||""===g||0===g.length)&&d.warn("ambersive.db: LocalStorage name is not set"),"undefined"!=typeof Storage?(k=localStorage.getItem(g),l=localStorage.getItem(h)):d.warn("ambersive.db: this browser doesn't support localStorage"),a.headers[i]=j+" "+k,null!==l&&(a.headers["Accept-Language"]=l,a.headers[m]=l),n(a),f.promise},response:function(a){var b=a.headers(),f=e.storageName,g=function(a){if(b[a]!==c&&""!==b[a]){if("undefined"!=typeof Storage)return localStorage.setItem(f,b[a]),b[a];d.warn("ambersive.db: this browser doesn't support localStorage")}},h=g(f);return(h===c||""===h)&&(h=g(f.toLocaleLowerCase())),a}};return g}]),angular.module("ambersive.db").factory("ambersiveDbInjector",["$injector","$q","$log","DBRegister","$rootScope",function(a,b,c,h,i){var j={request:function(a){var c=b.defer(),i=!1,j=g.toId(a),k=null,l=h.getUnique(32),m={},n="X-Req-ID",o="Req-ID",p=function(a){c.resolve(a)};return k=d.indexOf(j),a.headers[n]=l,a.headers[o]=l,a.reqID=l,m={config:a,deferred:c,reqId:l,id:j},k>-1?(e[k]=l,f[k]=m):(d.push(j),e.push(l),f.push(m)),angular.isDefined(i)===!0&&p(a),c.promise},response:function(a){var b=e.indexOf(a.config.reqID);return a.config.isLastCall=!1,b>-1&&(e.splice(b,1),f.splice(b,1),a.config.isLastCall=!0),a}};return j}]),angular.module("ambersive.db").config(["$httpProvider","$dbSettingsProvider",function(a,b){var c=null,d=b.$get().langName,e=b.$get().storageLang;a.interceptors.push("authenticationInjector"),a.interceptors.push("ambersiveDbInjector"),"undefined"!=typeof Storage&&(c=localStorage.getItem(e),null!==c&&(a.defaults.headers.common["Accept-Language"]=c,a.defaults.headers.common[d]=c))}]),angular.module("ambersive.db").provider("$dbSettings",[function(){var a="",b="application/json; charset=utf-8;",d="accessToken",e="language",f="Bearer",g="Authorization",h="Language",i="AMBERSIVE.DB",j={},k=!0,l=!1,m=function(a,b){return j[a]=b,j},n=function(a){return j[a]},o=function(b){return a=b},p=function(a){return b=a},q=function(a,b){if(a!==c&&b!==c){switch(a){case"tokenType":f=b;break;default:g=b}return b}},r=function(a){return d=a},s=function(a){return e=a},t=function(a){return i=a};return{register:m,setBaseUrl:o,setContentType:p,setTokenAttribute:q,setStorageName:r,setStorageLang:s,setDatabaseName:t,setAllow401Catcher:k,$get:function(){return{baseUrl:a,contentType:b,routes:j,route:n,storageName:d,storageLang:e,tokenName:g,tokenType:f,langName:h,databaseName:i,catch401Result:k,catchAllErrorResult:l}}}}]),angular.module("ambersive.db").factory("DB",["$q","$log","$http","$dbSettings","DBRegister","DBHelper",function(a,b,d,e,f,g){var h="",i=null,j={},k=function(a,b){var d={method:a.toUpperCase()},f=e.baseUrl,g="/",h="";switch(b!==c&&b.baseUrl!==c&&b.baseUrl.length>0&&(f=b.baseUrl),b!==c&&b.url!==c&&(h=b.url),f!==c&&f.endsWith(g)?g="":f+=g,a){default:d.url=f+g+h}return d.headers={},d.headers["Content-Type"]=e.contentType,b!==c&&b.contentType!==c&&(d.headers["Content-Type"]=b.contentType),d},l=function(b){return{$has:function(b){var d=a.defer();return j[h]===c||j[h][b]===c?d.resolve(!1):d.resolve(!0),d.promise},get:function(c){var d=a.defer();return i=k("get",b),angular.isDefined(c)&&(i.params=c),g.execute(i).then(function(a){d.resolve(a)},function(a){d.reject(a)}),d.promise},getById:function(c,d){var e=a.defer();return i=k("get",b),i.url+="/"+c,angular.isDefined(d)&&(i.params=d),g.execute(i).then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise},update:function(c,d,e){var f=a.defer(),h=k("put",b);return h.url+="/"+c,h.data=d,angular.isDefined(e)&&(h.params=e),g.execute(h).then(function(a){f.resolve(a)},function(a){f.reject(a)}),f.promise},create:function(c,d){var e=a.defer(),f=k("post",b);return f.data=c,angular.isDefined(d)&&(f.params=d),g.execute(f).then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise},"delete":function(c,d){var e=a.defer(),f=k("delete",b);return f.url+="/"+c,angular.isDefined(d)&&(f.params=d),g.execute(f).then(function(a){e.resolve(a)},function(a){e.reject(a)}),e.promise}}},m=function(){var d,f,g=null,i=null,k=[],m=!1;return arguments.length>0?(angular.isObject(arguments[0])&&arguments[0].name!==c&&(i=arguments[0].name,arguments[1]!==c&&(m=arguments[1])),angular.isString(arguments[0])&&(i=arguments[0]),"$"===i?g={classes:function(){var b=a.defer(),c=Object.keys(j),d=[],e=0,f=0;for(angular.isDefined(c)===!0&&(f=c.length),e=0;f>e;e+=1)d.push({key:c[e]});return angular.isDefined(d)&&b.resolve(d),b.promise},methods:function(b){var c=a.defer(),d=null,e=[],f=[],g=0,h=0;if(angular.isDefined(j[b])){for(d=j[b],e=Object.keys(d),angular.isDefined(e)===!0&&(h=e.length),g=0;h>g;g+=1)"$"===e[g].substr(0,1)&&f.push({key:e[g]});c.resolve(f)}else c.reject(f);return c.promise}}:(j[i]===c&&m===!1?(f=e.route(i),(f===c||angular.isObject(arguments[0]))&&(f=arguments[0]),j[i]=new l(f),k=[],d=e.route(i),d===c&&angular.isObject(arguments[0])&&(d=f),d!==c&&d.except!==c&&(k=d.except),k.length>0&&k.forEach(function(a,b){j[i][a]!==c&&delete j[i][a]})):m===!0&&(f=e.route(i),(f===c||angular.isObject(arguments[0]))&&(f=arguments[0]),k=[],d=e.route(i),d===c&&angular.isObject(arguments[0])&&(d=f),j[i]===c&&(j[i]=new l(d),d!==c&&d.except!==c&&(k=d.except),k.length>0&&k.forEach(function(a,b){j[i][a]!==c&&delete j[i][a]}))),angular.isObject(arguments[0])&&arguments[0].name!==c&&arguments[0].fnName!==c&&(j[i][arguments[0].fnName]=arguments[0].fn),h=i,g=j[i])):b.warn("Please define a Service"),g};return m}]),angular.module("ambersive.db").factory("REST",["$q","$log","$http","$dbSettings",function(a,b,c,d){var e=function(b){var d=a.defer();return c(b).success(function(a,b,c,e){d.resolve(a,c)}).error(function(a,b,c,e){d.reject(a,c)}),d.promise};return e}])}(window,document,void 0);